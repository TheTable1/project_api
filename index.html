<!DOCTYPE html>
<html lang="th">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0 ">
    <meta charset="UTF-8">
    <title>Project Manager</title>
    <style>
    body { font-family: sans-serif; padding: 20px; }
    input, textarea, button { margin: 5px; padding: 5px; width: 100%; max-width: 400px; }
    .project { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
  </style>
  </head>
  <body>

    <h1>Project Manager</h1>

    <!-- Form ‡πÄ‡∏û‡∏¥‡πà‡∏° Project -->
    <h2>‡πÄ‡∏û‡∏¥‡πà‡∏° Project</h2>
    <input type="text" id="pName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå">
    <input type="datetime-local" id="pDateStart" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">
    <input type="datetime-local" id="pDateEnd" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î">
    <input type="text" id="pStatus" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÄ‡∏ä‡πà‡∏ô In Progress)">
    <textarea id="pDescription" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå"></textarea>
    <button onclick="createProject()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå</button>

    <hr>

    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå -->
    <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Project</h2>
    <div id="projectList"></div>

    <script>
    const apiUrl = "http://localhost:4000"; // ‡πÅ‡∏Å‡πâ‡∏ï‡∏≤‡∏°‡∏û‡∏≠‡∏£‡πå‡∏ï API

    // üìå ‡∏≠‡πà‡∏≤‡∏ô project ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° endpoint GET /projects ‡πÑ‡∏î‡πâ‡πÉ‡∏ô backend ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    async function fetchProjects() {
      document.getElementById("projectList").innerHTML = "";
      for (let i = 1; i <= 10; i++) { // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å id 1-10
        try {
          const res = await fetch(`${apiUrl}/project/${i}`);
          if (!res.ok) continue;
          const project = await res.json();
          renderProject(project);
        } catch (err) {
          console.error("‡πÑ‡∏°‡πà‡∏û‡∏ö project id:", i);
        }
      }
    }

    // üßæ ‡πÅ‡∏™‡∏î‡∏á Project
    function renderProject(project) {
      const div = document.createElement("div");
      div.className = "project";
      div.innerHTML = `
        <b>${project.pName}</b> (${project.pStatus || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"})<br>
        ‡πÄ‡∏£‡∏¥‡πà‡∏°: ${new Date(project.pDateStart).toLocaleString()}<br>
        ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î: ${project.pDateEnd ? new Date(project.pDateEnd).toLocaleString() : "-"}<br>
        ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${project.pDescription || "-"}<br>
        <button onclick="deleteProject(${project.pId})">‡∏•‡∏ö</button>
        <button onclick="editProjectPrompt(${project.pId})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      `;
      document.getElementById("projectList").appendChild(div);
    }

    // ‚ûï POST /project/create
    async function createProject() {
      const body = {
        pName: document.getElementById("pName").value,
        pDateStart: new Date(document.getElementById("pDateStart").value).toISOString(),
        pDateEnd: document.getElementById("pDateEnd").value ? new Date(document.getElementById("pDateEnd").value).toISOString() : null,
        pStatus: document.getElementById("pStatus").value,
        pDescription: document.getElementById("pDescription").value
      };

      await fetch(`${apiUrl}/project/create`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      alert("‡πÄ‡∏û‡∏¥‡πà‡∏° Project ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      fetchProjects();
    }

    // üóëÔ∏è DELETE /project/delete/{id}
    async function deleteProject(id) {
      if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?")) return;
      await fetch(`${apiUrl}/project/delete/${id}`, { method: "DELETE" });
      fetchProjects();
    }

    // ‚úèÔ∏è PUT /project/edit/{id}
    async function editProjectPrompt(id) {
      const pName = prompt("‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà:");
      const pStatus = prompt("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà:");

      if (!pName || !pStatus) return;

      const body = {
        pName,
        pDateStart: new Date().toISOString(), // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
        pStatus
      };

      await fetch(`${apiUrl}/project/edit/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÅ‡∏•‡πâ‡∏ß");
      fetchProjects();
    }

    fetchProjects(); // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
  </script>

  </body>
</html>
